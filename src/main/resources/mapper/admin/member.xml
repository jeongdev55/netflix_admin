<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">




<mapper namespace="Member">

	<resultMap type="AdminMemberVO" id="memberResult">
		<result property="email" column="email" />
		<result property="pass" column="pass" />
		<result property="nickname" column="nickname" />
		<result property="phonenumber" column="phonenumber" />
		<result property="age" column="age" />
		<result property="join_date" column="join_date" />
		<result property="ticket_id" column="ticket_id" />
		<result property="confirm" column="confirm" />
		<result property="month" column="month" />
		<result property="count" column="count" />
	</resultMap>
	
	
	<resultMap type="map" id="monthlyMember">
		<result property="month" column="month" />
		<result property="count" column="count" />
	</resultMap>
	
	<resultMap type="map" id="AnalysisData">
		<result property="month" column="month" />
		<result property="age" column="age" />
		<result property="ticket_id" column="ticket_id" />
		<result property="confirm" column="confirm" />
	</resultMap>
	


	<select id ="analysisData" resultMap="monthlyMember">
			select to_char(join_date,'mm') as "month", age,nvl(ticket_id,0) "ticket_id",confirm
			from member
			
	</select>
	
		<select id ="getmonthData" resultMap="AnalysisData">
			select to_char(join_date,'mm') as "month", count(*)as count
			from member
			group by to_char(join_date,'mm') order by 1
	</select>

	<select id="getAllMember" parameterType="hashMap"
		resultMap="memberResult">
	SELECT *
	from member
	order by join_date asc
	</select>
	
	<select id="getOneMember" parameterType="AdminMemberVO" resultType="AdminMemberVO">
	select *
	from member
	where email=#{email}
	</select>
	
	<select id="getTotalCount" parameterType="hashMap"
		resultType="int">
		select count(*) from member
		where 1=1
	</select>

	<insert id="insertMember" parameterType="AdminMemberVO" >
		insert into member(email, pass, nickname, phonenumber,age,join_date,ticket_id,confirm)
		values(#{email}, #{pass}, #{nickname}, #{phonenumber}, #{age},#{join_date},#{ticket_id},#{confirm})
	</insert>
	
	<delete id="deleteMember" parameterType="AdminMemberVO" >
		delete from member where email=#{email}
	</delete>
	
	<update id="modifyMember" parameterType="AdminMemberVO" >
		update member
		set email=#{email},pass=#{pass},nickname=#{nickname},phonenumber=#{phonenumber},age=#{age},join_date=#{join_date},ticket_id=#{ticket_id},confirm=#{confirm}
		where email=#{email}
	</update>
</mapper>